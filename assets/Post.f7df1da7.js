import{u as w,j as m,k as x,z as B,o as r,c as o,a as n,l as M,v as F,b as u,F as b,n as f,p,t as h}from"./index.15b5e9bb.js";import{k as C,l as D}from"./metawall.85f25148.js";const I=n("h2",{class:"text-center border border-dark border-2 py-4 bg-white mb-4 position-relative border-overlap border-overlap-start fw-bold"},"\u5F35\u8CBC\u52D5\u614B",-1),P={class:"p-8 shadow-lg border border-dark border-2 rounded bg-white"},T=n("label",{for:"newsFeedTextarea",class:"mb-1 d-block"},"\u8CBC\u6587\u5167\u5BB9",-1),U={key:0,class:"d-flex justify-content-center flex-wrap align-items-center mb-8"},V=["src","alt"],j={key:1,class:"d-flex flex-column align-items-center text-danger"},z={class:"d-flex justify-content-center"},A=["disabled"],E={key:0,class:"form-text"},N={setup(R){const v=w(),l=m(""),c=m(null),d=m(""),a=x({imagesBase64:[],errorMessage:[]}),k=async()=>{const i=await C().then(s=>s.data.data._id),t=Array.from(c.value.files),e=new FormData;t.forEach(s=>{e.append("photos",s)}),e.append("user",i),e.append("content",l.value),l.value="",D(e,{mimeType:"multipart/form-data"}).then(s=>{s.data.status==="success"&&(d.value="success",a.imagesBase64.length=0,v.push({name:"home"}))})},y=i=>{a.imagesBase64.length=0,a.errorMessage.length=0;const t=Array.from(i.target.files),e=t.some(s=>s.size>=2*1024*1024);t.length>10&&(a.errorMessage.push("\u6A94\u6848\u6578\u91CF\u4E0D\u80FD\u8D85\u904E 10 \u5F35"),a.imagesBase64.length=0),e&&(a.errorMessage.push("\u6A94\u6848\u5927\u5C0F\u9700\u5728 2 MB \u4EE5\u5167"),a.imagesBase64.length=0),t.length<=10&&!e&&t.forEach(s=>{const g=new FileReader;g.readAsDataURL(s),g.onload=_=>{a.imagesBase64.push(_.target.result)}})};return B(l,i=>{d.value=""}),(i,t)=>(r(),o("div",null,[I,n("div",P,[T,M(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),name:"",id:"newsFeedTextarea",cols:"30",rows:"10",class:"w-100 mb-4 border border-dark border-2"},null,512),[[F,l.value]]),n("input",{onChange:t[1]||(t[1]=e=>y(e)),ref_key:"imageFile",ref:c,type:"file",name:"photos",class:"d-none btn btn-dark px-8 py-1 mb-4",multiple:"multiple"},null,544),n("input",{type:"button",value:"\u4E0A\u50B3\u5716\u7247",class:"btn btn-dark px-8 py-1 mb-4",onClick:t[2]||(t[2]=e=>c.value.click())}),u(a).imagesBase64.length>0?(r(),o("div",U,[(r(!0),o(b,null,f(u(a).imagesBase64,(e,s)=>(r(),o("img",{key:`image${s}`,src:e,alt:`image${s}`,class:"img-fluid w-25 h-25 mb-2 mx-3"},null,8,V))),128))])):p("",!0),u(a).errorMessage.length>0?(r(),o("p",j,[(r(!0),o(b,null,f(u(a).errorMessage,(e,s)=>(r(),o("span",{key:s},h(s+1+". "+e),1))),128))])):p("",!0),n("div",z,[n("input",{type:"button",class:"w-50 mx-auto py-4 btn btn-secondary bg-black-50",value:"\u9001\u51FA\u8CBC\u6587",onClick:k,disabled:!l.value},null,8,A),d.value?(r(),o("div",E,h(d.value),1)):p("",!0)])])]))}};export{N as default};
